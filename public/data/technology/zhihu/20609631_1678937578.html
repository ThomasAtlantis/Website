<p data-pid="VTJdbB5J">最近恰巧也遇到了这个问题，网上貌似没有完整详细的解答。解释一下我对题主的意思的理解：在使用python的setup.py将项目打包成wheel时，需要打包项目外的静态文件，但是无论setup的data_files参数如何设置，打包得到的轮子在安装后，静态文件都无法自动存储于该库的安装目录下。这其实是由于setup打包轮子的脚本不鼓励绝对路径，而相对路径是基于sys.prefix的。所以想要自动存储在安装目录下，可以死了这条心了。</p><p data-pid="1FkDcsTp"><a href="https://zhuanlan.zhihu.com/p/276461821?utm_source=wechat_session" class="internal" target="_blank">王炳明：花了两天，终于把 Python 的 setup.py 给整明白了</a> 这篇文章是我在全网看到的对setuptool讲解最为细致全面的，但是当然它没有提到题主的问题。下面我详细解释一下data_files参数，也作为一个学习的记录。</p><h2>静态文件是什么</h2><p data-pid="5S-jV3x2">这里指的是除去*.py文件以外的其他类型的文件。我尝试过将包含图片和网页文件的文件夹作为package进行打包，企图通过这种方式把静态文件包含在轮子里。事实证明轮子安装后这个文件夹下只有_init_.py一个文件。在打包时，我们一般把静态文件综合起来放在top-level的package外面，即和setup.py同级目录下。</p><h2>两种静态文件打包方法</h2><p data-pid="Z7T2RBDB">在打包egg、tar.gz等格式时，编写<a href="https://link.zhihu.com/?target=http%3A//MANIFEST.in" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">MANIFEST.in</span><span class="invisible"></span></a>将静态文件的路径include进来，注意这里的语法支持通配符，参考<a href="https://link.zhihu.com/?target=https%3A//www.jianshu.com/p/48d7c20cb950" class=" wrap external" target="_blank" rel="nofollow noreferrer">Python打包时包含静态文件处理方法</a>。相关文章很多，大多互相抄袭而且不给引用，强烈谴责，因为我也找不到最早的原创了，在此引一篇还算清晰的。</p><p data-pid="dRHcB8rE">在打包whl格式时，不需编写<a href="https://link.zhihu.com/?target=http%3A//MANIFEST.in" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">MANIFEST.in</span><span class="invisible"></span></a>，而是通过data_files参数将静态文件路径包含进来，并指定安装时的存储位置。在3.1版本之后的setup中，不设置模板文件<a href="https://link.zhihu.com/?target=http%3A//MANIFEST.in" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">MANIFEST.in</span><span class="invisible"></span></a>时，会将data_files中的文件自动添加到MANIFEST中。提一下另外一位答主的答案，的确可以不使用sdist参数来打包，但是对于必须使用whl格式的场景，这个问题是绕不开的，毕竟轮子现在是python的官方标准二进制文件，并且在pypi上发布时也需要。</p><h2>data_files参数详解</h2><p data-pid="ukgaGzGy">参考官方文档<a href="https://link.zhihu.com/?target=https%3A//docs.python.org/3.8/distutils/setupscript.html%23installing-additional-files" class=" wrap external" target="_blank" rel="nofollow noreferrer">2. Writing the Setup Script</a>，以下是我的翻译和注解。</p><p data-pid="vkoFjwAf"><code>data_files</code>参数可以用于指定模块发布所需的额外文件：配置文件、信息目录、数据文件和其他前文没有提到的文件类型。文档中前文提到了包数据文件*.dat，编写python语言扩展模块时可能用到的*.c和*.i。</p><p data-pid="yPOOGPKs"><code>data_files</code>按照下面例子中给出的方式指定了一个<code>(directory, files)</code>对儿的列表。</p><div class="highlight"><pre><code class="language-python3"><span></span><span class="n">setup</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">'bitmaps'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'bm/b1.gif'</span><span class="p">,</span> <span class="s1">'bm/b2.gif'</span><span class="p">]),</span> 
    <span class="p">(</span><span class="s1">'config'</span><span class="p">,</span>  <span class="p">[</span><span class="s1">'cfg/data.cfg'</span><span class="p">])</span>
<span class="p">],)</span>
</code></pre></div><p data-pid="1uCZhODF">每一个<code>(directory, files)</code>对儿指定了安装时文件的存储路径，和文件目前存储的位置。</p><p data-pid="xWx8oMoE"><b>后者</b>files是相对于setup.py脚本的相对路径。注意你可以指定安装时存储的路径，却不能在安装时自动给文件重命名。files中文件夹的名字不会影响安装时路径的命名，这里只关心文件的名字。</p><p data-pid="bpLhCg4w"><b>前者</b>directory的安装存储路径同样应为相对路径，它相对于安装前缀（系统级安装时为sys.prefix，用户级安装时为site.USER_BASE，我们一般都是系统级安装。）Distutil在最上面引用的那篇文章中有提到，是setup的前身，支持绝对路径，但是在打包轮子的脚本里面故意去掉了这个支持。这种改进的用心其实很好理解，你可以输出这几个路径观察一下，我的电脑上是这样的：</p><div class="highlight"><pre><code class="language-text"><span></span>&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.prefix
'/Users/liushangyu/opt/anaconda3'
&gt;&gt;&gt; sys.exec_prefix
'/Users/liushangyu/opt/anaconda3'
&gt;&gt;&gt; get_python_lib()
'/Users/liushangyu/opt/anaconda3/lib/python3.8/site-packages'
</code></pre></div><p data-pid="VN7Z6YwY">题主肯定是和我最初一样希望静态文件能随着库文件夹都安装在get_python_lib()的路径下，但是不同用户的python版本不同，安装路径也可能不同，就无法确定这个前缀lib/python3.8/site-packages中的python3.8具体是多少了。为了安装时的兼容性，我们当然不能设置绝对路径。</p><p data-pid="ontc9sTU">我试验设置绝对路径，setup将我的绝对路径拼接在get_python_lib()路径后面得到一个超级深的目录；我试验设置相对路径前面加上<code>/</code>，因为怀疑绝对路径是由于有<code>/</code>而导致的，结果路径无法解析；我试验拼接上get_python_lib()减去sys.prefix的那部分，结果又拼接到了get_python_lib()上面；只有在直接设置一个和get_python_lib()中的路径不重合的相对路径时，是拼接到sys.prefix上面的。</p><p data-pid="C6ZS9JJq">这个问题在Github的issue中也有讨论：<a href="https://link.zhihu.com/?target=https%3A//github.com/pypa/wheel/issues/92" class=" wrap external" target="_blank" rel="nofollow noreferrer">bdist_wheel makes absolute data_files relative to site-packages</a>。我不知道目前与更高版本的python兼容的setuptool是否有更高版本，我的一个朋友发布时用的是Python3.9环境下的绝对路径，我不知道他怎么成功的。</p>