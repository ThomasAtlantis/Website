<div>最近写了一个知乎文章自动同步个人网站的工具。<br/><br/># 先聊一聊我的网站架构<br/>网站后台使用Django，而前端纯手撸，设计了一个很特殊的文章显示模式：文章使用html格式以iframe的形式嵌入到主站中。这样做呢，有利有弊。<br/><br/>【好处】文章异步加载很方便；本地编辑，html导入的方式基本支持了所有编辑语言，比如我可以用typora写markdown然后自动导出html，也可以用word自动导出html，只需在服务器端控制样式表统一即可；支持所有网页支持的功能，我只需要修改html，甚至可以插入个h5的游戏在文章里，这为未来的交互式文章做铺垫。<br/><br/>【坏处】对seo优化可能不利；页面跳转困难；主站失去了对iframe的控制权，因为浏览器的csrf攻击保护，所以需要更复杂的逻辑。<br/><br/># 最近发现的新的好处<br/>知乎的文章导出为html要比markdown容易的多，很多站长使用的现成的博客框架都只支持markdown和富文本，很难同步。我只需要将知乎文章爬下来做一些简单的修补即可上线。<br/><br/># 知乎的反爬虫防御措施<br/>知乎为了防止盗链，图片爬下来的链接是低清的，但是它高清的链接藏在了data-original和data-actualsrc里面了，只需要替换一下。然而GIF图很不好办。知乎采取了网页加载速度优化，大一点的GIF会被优化成video，小一点的会被优化成webp，这二者都不能爬到。要解决这个问题，可能要使用selenium之类的基于浏览器内核的爬虫方法，我还没有尝试。<br/><br/>网页加载速度优化可以参考下面的网站。使用Chrome浏览器新推出的lighthouse可以分析页面的性能，里面也会推荐使用video和webp替换gif。我未来可能出一些文章讲网页优化。<br/><a href="https://link.zhihu.com/?target=https%3A//web.dev/replace-gifs-with-videos/" data-icon-type="link" data-original-url="https://web.dev/replace-gifs-with-videos/" class="external" data-icon-name="zhicon_icon_24_link">链接</a></div>