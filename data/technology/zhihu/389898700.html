<p data-pid="paHaZRYR">本文主要参考了两部计算机图形学经典教材，已在我的个人网站上提供资源链接：<a href="http://link.zhihu.com/?target=https%3A//liushangyu.xyz/post/%2324" class=" wrap external" target="_blank" rel="nofollow noreferrer">人间纪行 | 计算机图形学经典教材</a>，各位客官点赞后自取「第一次恬着脸要赞」：<b>3D计算机图形学（第三版）中文版</b>；<b>计算机视觉中的多视图几何中、英文版</b>。最近在研究三维重建的代码时涉及到相机姿态和内外参数的概念，不是很明白，所以学习和记录一下。</p><h2>摄像机模型的物理学原理</h2><p data-pid="i7_R-8Q9"><b>摄像机</b>可以定义为3D世界到2D图像之间的一种映射。我们生活中使用的手机摄像头和单反相机究其根本都是<b>小孔成像</b>的原理。本文要讨论的模型也为最简单的<b>针孔相机模型</b>。想象一下，在一个黑盒子的一面用针戳一个小孔，在它对面内部铺设一层感光材料，那么物理世界的物体发出或反射出的光线穿过小孔就会在感光板上呈现出一个<b>清晰的、倒置的、较暗的</b>图像。</p><p data-pid="IB4bkbKD"><b>为什么是清晰的呢？</b>因为理想的针孔只能通过一束光线，即物理世界的物体上的每一个点只与图像上的每一个点唯一对应。</p><ul><ul><li data-pid="Ian2YPKL">如果小孔太大，物体上的每个点发出的光线和小孔的边缘连线就组成了一个光锥，光锥照射在感光板上就会是一个光斑，那么图像就像是散光的人夜晚看路灯一样模糊。</li><li data-pid="tvQMRwY7">如果小孔太小，由于衍射效应，虽然物体上的点只有一束光线通过小孔，但穿过小孔后却会扩散成泊松亮斑。</li></ul></ul><p data-pid="OLfvHX37"><b>为什么是倒置的呢？</b>这个画画图就可以看出来：</p><figure data-size="normal"><noscript><img src="https://picx.zhimg.com/v2-7ec4072b5d886b4ab493f99c2952f743_720w.gif?source=d16d100b" data-size="normal" data-rawwidth="600" data-rawheight="260" data-thumbnail="https://pic1.zhimg.com/v2-7ec4072b5d886b4ab493f99c2952f743_720w.jpg?source=d16d100b" class="origin_image zh-lightbox-thumb" width="600" data-original="https://picx.zhimg.com/v2-7ec4072b5d886b4ab493f99c2952f743_720w.jpg?source=d16d100b"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='600'%20height='260'&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="600" data-rawheight="260" data-thumbnail="https://pic1.zhimg.com/v2-7ec4072b5d886b4ab493f99c2952f743_720w.jpg?source=d16d100b" class="origin_image zh-lightbox-thumb lazy" width="600" data-original="https://picx.zhimg.com/v2-7ec4072b5d886b4ab493f99c2952f743_720w.jpg?source=d16d100b" data-actualsrc="https://picx.zhimg.com/v2-7ec4072b5d886b4ab493f99c2952f743_720w.gif?source=d16d100b"><figcaption>图源： 如本科技RVBUST | 王朝阳 - 技术分享 | 计算机与机器视觉中的高精度相机标定 (上)</figcaption></figure><p data-pid="6Xaj0z9p"><b>为什么是较暗的呢？</b>根据以上对清晰图像的讨论，考虑可见光的波长以及人眼的最小分辨角，理论计算得到小孔的最佳直径为0.25mm左右，相当于F/200的光圈值。大多数光线都被盒子挡住了，小孔能够进入的光量有限，所以图像较暗。为了平衡图像亮度，实际拍摄的时候就需要延长曝光时间，我们有摄影学曝光补偿的计算公式：</p><p data-pid="HTKEoUeY"><img src="https://www.zhihu.com/equation?tex=EV%3D%5Clog_2+%28%5Cfrac%7Bf%5E2%7D%7Bt%7D%5Ccdot%5Cfrac%7B100%7D%7BISO%7D%29%5C%5C" alt="EV=\log_2 (\frac{f^2}{t}\cdot\frac{100}{ISO})\\" eeimg="1"> </p><p data-pid="7KpWZ3C1">其中 <img src="https://www.zhihu.com/equation?tex=f" alt="f" eeimg="1"> 代表光圈系数值， <img src="https://www.zhihu.com/equation?tex=t" alt="t" eeimg="1"> 代表快门（曝光）时间，ISO代表感光度。在图像传感器的感光度为100时，使用F/1光圈曝光1秒所需的曝光补偿定义为0。从公式中可以看出光圈系数增大2倍（光圈孔径缩小为一半），曝光时间需要延长4倍才能保持曝光量恒定。我的手机小米10Pro的近、远距摄像头都是F/2光圈，快门时间1/30秒的时候看起来与肉眼接近，可以想象F/200的光圈达到这个亮度至少需要曝光55分钟，即要求55分钟内景物不发生变化。文末我补充了光圈系数、感光度、曝光补偿的概念介绍。</p><p data-pid="FAvCmz_N">为了解决图像较暗的问题，我们应当扩大针孔以增加进光量，为了解决扩大针孔导致的图像模糊问题，我们<b>在小孔处放置一个凸透镜</b>，因为众所周知，凸透镜具有聚集光线的作用。但这也造成了新的问题：凸透镜无法将远近不同的点汇聚在同一平面上。于是我们引入<b>景深</b>和<b>对焦</b>的概念。</p><figure data-size="normal"><noscript><img src="https://picx.zhimg.com/v2-f028551d04a05c506f0126ea6385b826_720w.jpg?source=d16d100b" data-size="normal" data-rawwidth="547" data-rawheight="275" class="origin_image zh-lightbox-thumb" width="547" data-original="https://picx.zhimg.com/v2-f028551d04a05c506f0126ea6385b826_720w.jpg?source=d16d100b"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='547'%20height='275'&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="547" data-rawheight="275" class="origin_image zh-lightbox-thumb lazy" width="547" data-original="https://picx.zhimg.com/v2-f028551d04a05c506f0126ea6385b826_720w.jpg?source=d16d100b" data-actualsrc="https://picx.zhimg.com/v2-f028551d04a05c506f0126ea6385b826_720w.jpg?source=d16d100b"><figcaption>图源：百度百科 | 词条「镜头焦距」</figcaption></figure><p data-pid="NgjvvHV6">景物发出的光线通过凸透镜汇聚在焦平面上，而景物的近点和远点对应着不同的焦平面。如上图所示，光线相交的地方可以认为景物是完全清晰的，类似小孔成像的原理，景物的点和焦平面上的点唯一对应。此时的景物的近点和远点真正清晰的位置分别在当前焦平面的前后，那么在当前焦平面上就呈现为光斑。由于人眼的分辨能力有限，在光斑的弥散圆直径小于一定阈值时，人眼都会认为是清晰的，所以此时近、远点之间的景物都可以看清，它们之间的距离就被称作<b>景深</b>，而对应的焦平面之间的距离就被称作焦深。摄像机对焦的过程就是将感光板前后移动，直到它落在焦点平面附近的焦深范围内，这样就可以控制特定景物平面看起来更清晰。手机摄像头的自动对焦是通过控制音圈马达实现的，参考<a href="https://www.zhihu.com/question/21992503/answer/252829076" class="internal" target="_blank">手机摄像头对焦原理是怎么样的？</a>景深主要和焦距、光圈以及拍摄距离有关：拍摄距离越远、光圈越小、焦距越短，景深越大，参考<a href="https://zhuanlan.zhihu.com/p/55740729" class="internal" target="_blank">摩天：了解景深 这一篇就够了</a>。</p><h2>摄像机模型的数学描述</h2><p data-pid="ybXR1sRR">我们大概知道了摄像机成像的原理，但还需要对其进行定量的数学描述。前面已经提到摄像机是从3D世界到2D图像的一种映射，我们也可以称之为投影。这里我们考虑中心投影，即只考虑景物发出的通过凸透镜中心（光心）的那些光线，如下图中红色实线所示。我们将图像从 <img src="https://www.zhihu.com/equation?tex=x%5E%5Cprime" alt="x^\prime" eeimg="1"> 位置移动到 <img src="https://www.zhihu.com/equation?tex=x" alt="x" eeimg="1"> 处进行分析，那么物 <img src="https://www.zhihu.com/equation?tex=%5Cmathbf%7BX%7D" alt="\mathbf{X}" eeimg="1"> 、像 <img src="https://www.zhihu.com/equation?tex=x" alt="x" eeimg="1"> 与光心 <img src="https://www.zhihu.com/equation?tex=O" alt="O" eeimg="1"> 就组成了中心投影关系，其中 <img src="https://www.zhihu.com/equation?tex=O" alt="O" eeimg="1"> 为投影中心。</p><figure data-size="normal"><noscript><img src="https://picx.zhimg.com/v2-5ab35df5db03a00cb51d0a82893017fb_720w.jpg?source=d16d100b" data-caption="" data-size="normal" data-rawwidth="2248" data-rawheight="1172" class="origin_image zh-lightbox-thumb" width="2248" data-original="https://picx.zhimg.com/v2-5ab35df5db03a00cb51d0a82893017fb_720w.jpg?source=d16d100b"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='2248'%20height='1172'&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="2248" data-rawheight="1172" class="origin_image zh-lightbox-thumb lazy" width="2248" data-original="https://picx.zhimg.com/v2-5ab35df5db03a00cb51d0a82893017fb_720w.jpg?source=d16d100b" data-actualsrc="https://picx.zhimg.com/v2-5ab35df5db03a00cb51d0a82893017fb_720w.jpg?source=d16d100b"></figure><p data-pid="GjA7-6vc">我们假设有一个世界坐标系，即一个全局的、共识的坐标系，所有物理实体都对应这个坐标系下的一个坐标。假设<b>摄像机中心</b> <img src="https://www.zhihu.com/equation?tex=%5Ctext%7BC%7D" alt="\text{C}" eeimg="1"> （又称光心）在坐标原点处，摄像机的焦平面 <img src="https://www.zhihu.com/equation?tex=z%3Df" alt="z=f" eeimg="1"> 称为<b>图像平面</b>，摄像机中心到图像平面的垂线称为<b>主轴</b>或主摄线，即下图中的 <img src="https://www.zhihu.com/equation?tex=Z" alt="Z" eeimg="1"> 轴，主轴与图像平面交点称为<b>主点</b>，即下图的 <img src="https://www.zhihu.com/equation?tex=p" alt="p" eeimg="1"> 点（世界坐标系下为 <img src="https://www.zhihu.com/equation?tex=%280%2C0%2Cf%29" alt="(0,0,f)" eeimg="1"> )。另外注意我们这里使用的都是<b>右手坐标系</b>，右手系是标准的数学规范。</p><figure data-size="normal"><noscript><img src="https://picx.zhimg.com/v2-527e474da600f39a44a6781464ca0f75_720w.jpg?source=d16d100b" data-size="normal" data-rawwidth="1392" data-rawheight="721" class="origin_image zh-lightbox-thumb" width="1392" data-original="https://picx.zhimg.com/v2-527e474da600f39a44a6781464ca0f75_720w.jpg?source=d16d100b"></noscript><img src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1392'%20height='721'&gt;&lt;/svg&gt;" data-size="normal" data-rawwidth="1392" data-rawheight="721" class="origin_image zh-lightbox-thumb lazy" width="1392" data-original="https://picx.zhimg.com/v2-527e474da600f39a44a6781464ca0f75_720w.jpg?source=d16d100b" data-actualsrc="https://picx.zhimg.com/v2-527e474da600f39a44a6781464ca0f75_720w.jpg?source=d16d100b"><figcaption>图源：Multiple View Geometry in Computer Vision, Second Edition</figcaption></figure><p data-pid="wnPqnukd">假设景物中有一点 <img src="https://www.zhihu.com/equation?tex=%5Cmathbf%7BX%7D%3D%28X%2CY%2CZ%29%5E%5Cintercal" alt="\mathbf{X}=(X,Y,Z)^\intercal" eeimg="1"> 被映射到图像平面上的 <img src="https://www.zhihu.com/equation?tex=%5Ctextbf%7Bx%7D" alt="\textbf{x}" eeimg="1"> ，根据相似三角形我们可以算出这个投影过程：</p><p data-pid="nl3Ho8Ln"><img src="https://www.zhihu.com/equation?tex=%28X%2CY%2CZ%29%5E%5Cintercal+%5Cmapsto+%28fX%2FZ%2CfY%2FZ%29%5E%5Cintercal%5C%5C" alt="(X,Y,Z)^\intercal \mapsto (fX/Z,fY/Z)^\intercal\\" eeimg="1"> </p><p data-pid="MGJR5I2S">为了计算方便，我们还可以使用<b>齐次坐标</b>来表示中心投影。齐次坐标就是将一个原本是 <img src="https://www.zhihu.com/equation?tex=n" alt="n" eeimg="1"> 维的向量用一个 <img src="https://www.zhihu.com/equation?tex=n%2B1" alt="n+1" eeimg="1"> 维向量来表示，例如对于二维坐标 <img src="https://www.zhihu.com/equation?tex=%28x%2Cy%29" alt="(x,y)" eeimg="1"> ，对应的齐次坐标为 <img src="https://www.zhihu.com/equation?tex=%28xz%2Cyz%2Cz%29" alt="(xz,yz,z)" eeimg="1"> ，其中 <img src="https://www.zhihu.com/equation?tex=z" alt="z" eeimg="1"> 可以为任何非0实数，例如取1。更多介绍参考<a href="http://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%25E9%25BD%2590%25E6%25AC%25A1%25E5%259D%2590%25E6%25A0%2587/511284%3Ffr%3Daladdin" class=" wrap external" target="_blank" rel="nofollow noreferrer">齐次坐标_百度百科</a>。引入额外的维度是为了将当前空间下的平移操作从加法变成矩阵乘法，以统一形式。那么以上投影过程可以表示为矩阵形式：</p><p data-pid="u8neJK8x"><img src="https://www.zhihu.com/equation?tex=%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+X%5C%5CY%5C%5CZ%5C%5C1+%5Cend%7Barray%7D+%5Cright%5D%5Cmapsto%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+fX%5C%5CfY%5C%5CZ+%5Cend%7Barray%7D+%5Cright%5D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D+f+%26+%26+%26+0%5C%5C+%26+f+%26+%26+0%5C%5C+%26+%26+1+%26+0+%5Cend%7Barray%7D+%5Cright%5D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+X%5C%5CY%5C%5CZ%5C%5C1+%5Cend%7Barray%7D+%5Cright%5D%5C%5C" alt="\left[\begin{array}{c} X\\Y\\Z\\1 \end{array} \right]\mapsto\left[\begin{array}{c} fX\\fY\\Z \end{array} \right]=\left[\begin{array}{cccc} f &amp; &amp; &amp; 0\\ &amp; f &amp; &amp; 0\\ &amp; &amp; 1 &amp; 0 \end{array} \right]\left[\begin{array}{c} X\\Y\\Z\\1 \end{array} \right]\\" eeimg="1"> </p><p data-pid="fpIJOZe_">这里世界坐标系中的点 <img src="https://www.zhihu.com/equation?tex=%5Ctextbf%7BX%7D" alt="\textbf{X}" eeimg="1"> 表示为齐次矢量 <img src="https://www.zhihu.com/equation?tex=%28X%2CY%2CZ%2C1%29%5E%5Cintercal" alt="(X,Y,Z,1)^\intercal" eeimg="1"> ，图像坐标系中的点 <img src="https://www.zhihu.com/equation?tex=%5Ctextbf%7Bx%7D" alt="\textbf{x}" eeimg="1"> 表示为齐次矢量 <img src="https://www.zhihu.com/equation?tex=%28fX%2CfY%2CZ%29%5E%5Cintercal" alt="(fX,fY,Z)^\intercal" eeimg="1"> ，上面的矩阵被称为齐次摄像机投影矩阵 <img src="https://www.zhihu.com/equation?tex=%5Ctext%7BP%7D" alt="\text{P}" eeimg="1"> ，那么上式可以简写为：</p><p data-pid="Fnv1eD9s"><img src="https://www.zhihu.com/equation?tex=%5Cmathbf%7Bx%7D%3D%5Ctext%7BP%7D%5Cmathbf%7BX%7D%5C%5C" alt="\mathbf{x}=\text{P}\mathbf{X}\\" eeimg="1"> </p><p data-pid="mMsgO8kX">其中投影矩阵可以记作如下</p><p data-pid="U3l67JmV"><img src="https://www.zhihu.com/equation?tex=%5Ctext%7BP%7D%3D%5Ctext%7Bdiag%7D%28f%2Cf%2C1%29%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%5Cmathbf%7BI%7D+%5C+%7C%5Cmathbf%7B0%7D%5Cend%7Barray%7D%5Cright%5D%5C%5C" alt="\text{P}=\text{diag}(f,f,1)\left[\begin{array}{c}\mathbf{I} \ |\mathbf{0}\end{array}\right]\\" eeimg="1"> </p><p data-pid="WwzjAP-U">其中 <img src="https://www.zhihu.com/equation?tex=%5Ctext%7Bdiag%7D%28f%2Cf%2C1%29" alt="\text{diag}(f,f,1)" eeimg="1"> 是对角矩阵，而 <img src="https://www.zhihu.com/equation?tex=%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%5Cmathbf%7BI%7D+%5C+%7C%5Cmathbf%7B0%7D%5Cend%7Barray%7D%5Cright%5D" alt="\left[\begin{array}{c}\mathbf{I} \ |\mathbf{0}\end{array}\right]" eeimg="1"> 表示矩阵分块成一个3x3的单位矩阵拼接上一个全零列向量。由于上式我们假设图像平面的坐标原点在主点上，实际图像原点可能在图像一角，比如说左下角，这时需要修正上述公式，加入二维坐标系的平移。</p><p data-pid="QXp8sM5X"><img src="https://www.zhihu.com/equation?tex=%28X%2CY%2CZ%29%5E%5Cintercal+%5Cmapsto+%28fX%2FZ%2Bp_x%2CfY%2FZ%2Bp_y%29%5E%5Cintercal%5C%5C" alt="(X,Y,Z)^\intercal \mapsto (fX/Z+p_x,fY/Z+p_y)^\intercal\\" eeimg="1"> </p><p data-pid="qLso-XxI">其中 <img src="https://www.zhihu.com/equation?tex=%28p_x%2Cp_y%29%5E%5Cintercal" alt="(p_x,p_y)^\intercal" eeimg="1"> 是主点在图像坐标系下的坐标。同样我们可以用齐次坐标表示上述方程。</p><p data-pid="o6EaMme8"><img src="https://www.zhihu.com/equation?tex=%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+X%5C%5CY%5C%5CZ%5C%5C1+%5Cend%7Barray%7D+%5Cright%5D%5Cmapsto%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+fX%2Bp_x%5C%5CfY%2Bp_y%5C%5CZ+%5Cend%7Barray%7D+%5Cright%5D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D+f+%26+%26+p_x%26+0%5C%5C+%26+f+%26+p_y%26+0%5C%5C+%26+%26+1+%26+0+%5Cend%7Barray%7D+%5Cright%5D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+X%5C%5CY%5C%5CZ%5C%5C1+%5Cend%7Barray%7D+%5Cright%5D%5C%5C" alt="\left[\begin{array}{c} X\\Y\\Z\\1 \end{array} \right]\mapsto\left[\begin{array}{c} fX+p_x\\fY+p_y\\Z \end{array} \right]=\left[\begin{array}{cccc} f &amp; &amp; p_x&amp; 0\\ &amp; f &amp; p_y&amp; 0\\ &amp; &amp; 1 &amp; 0 \end{array} \right]\left[\begin{array}{c} X\\Y\\Z\\1 \end{array} \right]\\" eeimg="1"> </p><p data-pid="KHhXaEFl">若记</p><p data-pid="bDIF3SYc"><img src="https://www.zhihu.com/equation?tex=%5Ctext%7BK%7D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bccc%7D+f%26%26p_x%5C%5C+%26f%26p_y%5C%5C+%26%261+%5Cend%7Barray%7D+%5Cright%5D%5C%5C" alt="\text{K}=\left[\begin{array}{ccc} f&amp;&amp;p_x\\ &amp;f&amp;p_y\\ &amp;&amp;1 \end{array} \right]\\" eeimg="1"> </p><p data-pid="sBrNNGKa">则投影方程可表示为</p><p data-pid="EwaTXYz9"><img src="https://www.zhihu.com/equation?tex=%5Cmathbf%7Bx%7D%3D%5Ctext%7BK%7D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%5Cmathbf%7BI%7D+%5C+%7C%5Cmathbf%7B0%7D%5Cend%7Barray%7D%5Cright%5D%5Cmathbf%7BX%7D%5C%5C" alt="\mathbf{x}=\text{K}\left[\begin{array}{c}\mathbf{I} \ |\mathbf{0}\end{array}\right]\mathbf{X}\\" eeimg="1"> </p><p data-pid="DVlVD6ng">矩阵 <img src="https://www.zhihu.com/equation?tex=%5Ctext%7BK%7D" alt="\text{K}" eeimg="1"> 称为<b>摄像机标定矩阵</b>。由于我们之前假设摄像机中心在世界坐标系原点处，即摄像机坐标系和世界坐标系重合，但实际上它们未必重合。两个坐标系可以通过旋转和平移互相变换。将上面讨论的点 <img src="https://www.zhihu.com/equation?tex=%5Cmathbf%7BX%7D" alt="\mathbf{X}" eeimg="1"> 在世界坐标系下重新记为 <img src="https://www.zhihu.com/equation?tex=%5Cwidetilde%7B%5Cmathbf%7BX%7D%7D" alt="\widetilde{\mathbf{X}}" eeimg="1"> ，在摄像机坐标系下记为 <img src="https://www.zhihu.com/equation?tex=%5Cwidetilde%7B%5Ctextbf%7BX%7D%7D_%7Bcam%7D" alt="\widetilde{\textbf{X}}_{cam}" eeimg="1"> ，假设 <img src="https://www.zhihu.com/equation?tex=%5Cwidetilde%7B%5Cmathbf%7BC%7D%7D" alt="\widetilde{\mathbf{C}}" eeimg="1"> 为摄像机中心在世界坐标系中的坐标。则有</p><p data-pid="69GTIQAS"><img src="https://www.zhihu.com/equation?tex=%5Cwidetilde%7B%5Cmathbf%7BX%7D%7D_%7Bcam%7D%3D%5Ctext%7BR%7D%28%5Cwidetilde%7B%5Cmathbf%7BX%7D%7D-%5Cwidetilde%7B%5Cmathbf%7BC%7D%7D%29%5C%5C" alt="\widetilde{\mathbf{X}}_{cam}=\text{R}(\widetilde{\mathbf{X}}-\widetilde{\mathbf{C}})\\" eeimg="1"> </p><p data-pid="8QWABh-l">其中 <img src="https://www.zhihu.com/equation?tex=%5Ctext%7BR%7D" alt="\text{R}" eeimg="1"> 是一个3x3的旋转矩阵。这个方程可以变形为：</p><p data-pid="MAx3OpGv"><img src="https://www.zhihu.com/equation?tex=%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+%5Cwidetilde%7B%5Cmathbf%7BX%7D%7D_%7Bcam%7D%5C%5C+1+%5Cend%7Barray%7D+%5Cright%5D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+%5Ctext%7BR%7D%28%5Cwidetilde%7B%5Cmathbf%7BX%7D%7D-%5Cwidetilde%7B%5Cmathbf%7BC%7D%7D%29%5C%5C+1+%5Cend%7Barray%7D+%5Cright%5D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+%5Ctext%7BR%7D%5Cwidetilde%7B%5Cmathbf%7BX%7D%7D-%5Ctext%7BR%7D%5Cwidetilde%7B%5Cmathbf%7BC%7D%7D%5C%5C+1+%5Cend%7Barray%7D+%5Cright%5D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcc%7D+%5Ctext%7BR%7D+%26+-%5Ctext%7BR%7D%5Cwidetilde%7B%5Cmathbf%7BC%7D%7D%5C%5C+%5Ctextbf%7B0%7D%5E%5Cintercal%261+%5Cend%7Barray%7D+%5Cright%5D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+%5Cwidetilde%7B%5Cmathbf%7BX%7D%7D%5C%5C+1+%5Cend%7Barray%7D+%5Cright%5D%5C%5C" alt="\left[\begin{array}{c} \widetilde{\mathbf{X}}_{cam}\\ 1 \end{array} \right]=\left[\begin{array}{c} \text{R}(\widetilde{\mathbf{X}}-\widetilde{\mathbf{C}})\\ 1 \end{array} \right]=\left[\begin{array}{c} \text{R}\widetilde{\mathbf{X}}-\text{R}\widetilde{\mathbf{C}}\\ 1 \end{array} \right]=\left[\begin{array}{cc} \text{R} &amp; -\text{R}\widetilde{\mathbf{C}}\\ \textbf{0}^\intercal&amp;1 \end{array} \right]\left[\begin{array}{c} \widetilde{\mathbf{X}}\\ 1 \end{array} \right]\\" eeimg="1"> </p><p data-pid="GmCvcPUM">记齐次坐标</p><p data-pid="RdOGJeaH"><img src="https://www.zhihu.com/equation?tex=%5Cmathbf%7BX%7D_%7Bcam%7D%3D%28%5Cwidetilde%7B%5Cmathbf%7BX%7D%7D_%7Bcam%7D%2C1%29%5E%5Cintercal%2C+%5C+%5Cmathbf%7BX%7D%3D%28%5Cwidetilde%7B%5Cmathbf%7BX%7D%7D%2C1%29%5E%5Cintercal%5C%5C" alt="\mathbf{X}_{cam}=(\widetilde{\mathbf{X}}_{cam},1)^\intercal, \ \mathbf{X}=(\widetilde{\mathbf{X}},1)^\intercal\\" eeimg="1"> </p><p data-pid="ZPr4rWQ3">再根据上面齐次摄像机投影方程的结论，我们最终得到一般情况下，世界坐标系中的齐次坐标点 <img src="https://www.zhihu.com/equation?tex=%5Ctextbf%7BX%7D" alt="\textbf{X}" eeimg="1"> 到图像坐标系中的齐次坐标点 <img src="https://www.zhihu.com/equation?tex=%5Ctextbf%7Bx%7D" alt="\textbf{x}" eeimg="1"> 的变换方程：</p><p data-pid="TywLkDuL"><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5Cmathbf%7Bx%7D%26%3D%5Ctext%7BK%7D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%5Cmathbf%7BI%7D+%5C+%7C%5Cmathbf%7B0%7D%5Cend%7Barray%7D%5Cright%5D%5Cmathbf%7BX%7D_%7Bcam%7D%5C%5C+%26%3D%5Ctext%7BK%7D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%5Cmathbf%7BI%7D+%5C+%7C%5Cmathbf%7B0%7D%5Cend%7Barray%7D%5Cright%5D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcc%7D+%5Ctext%7BR%7D+%26+-%5Ctext%7BR%7D%5Cwidetilde%7B%5Cmathbf%7BC%7D%7D%5C%5C+%5Ctextbf%7B0%7D%5E%5Cintercal%261+%5Cend%7Barray%7D+%5Cright%5D%5Cmathbf%7BX%7D%5C%5C+%26%3D%5Ctext%7BK%7D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcc%7D+%5Ctext%7BR%7D+%5C+%7C+-%5Ctext%7BR%7D%5Cwidetilde%7B%5Cmathbf%7BC%7D%7D%5Cend%7Barray%7D+%5Cright%5D%5Cmathbf%7BX%7D%5C%5C+%26%3D%5Ctext%7BK%7D%5Ctext%7BR%7D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcc%7D+%5Ctextbf%7BI%7D%5C+%7C+-%5Cwidetilde%7B%5Cmathbf%7BC%7D%7D%5Cend%7Barray%7D+%5Cright%5D%5Cmathbf%7BX%7D+%5Cend%7Balign%2A%7D%5C%5C" alt="\begin{align*} \mathbf{x}&amp;=\text{K}\left[\begin{array}{c}\mathbf{I} \ |\mathbf{0}\end{array}\right]\mathbf{X}_{cam}\\ &amp;=\text{K}\left[\begin{array}{c}\mathbf{I} \ |\mathbf{0}\end{array}\right]\left[\begin{array}{cc} \text{R} &amp; -\text{R}\widetilde{\mathbf{C}}\\ \textbf{0}^\intercal&amp;1 \end{array} \right]\mathbf{X}\\ &amp;=\text{K}\left[\begin{array}{cc} \text{R} \ | -\text{R}\widetilde{\mathbf{C}}\end{array} \right]\mathbf{X}\\ &amp;=\text{K}\text{R}\left[\begin{array}{cc} \textbf{I}\ | -\widetilde{\mathbf{C}}\end{array} \right]\mathbf{X} \end{align*}\\" eeimg="1"> </p><p data-pid="yAQdbTPn">有时候习惯记 <img src="https://www.zhihu.com/equation?tex=%5Cmathbf%7Bt%7D%3D-%5Ctext%7BR%7D%5Cwidetilde%7B%5Cmathbf%7BC%7D%7D" alt="\mathbf{t}=-\text{R}\widetilde{\mathbf{C}}" eeimg="1"> ，那么摄像机投影矩阵就可以定义为</p><p data-pid="JIL1FPPh"><img src="https://www.zhihu.com/equation?tex=%5Ctext%7BP%7D%3D%5Ctext%7BK%7D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%5Ctext%7BR%7D+%5C+%7C%5Cmathbf%7Bt%7D%5Cend%7Barray%7D%5Cright%5D%5C%5C" alt="\text{P}=\text{K}\left[\begin{array}{c}\text{R} \ |\mathbf{t}\end{array}\right]\\" eeimg="1"> </p><p data-pid="lIGjBJJB">这个矩阵共有9个自由度，其中3个来自 <img src="https://www.zhihu.com/equation?tex=%5Ctext%7BK%7D" alt="\text{K}" eeimg="1"> ，3个来自 <img src="https://www.zhihu.com/equation?tex=%5Ctext%7BR%7D" alt="\text{R}" eeimg="1"> ，3个来自 <img src="https://www.zhihu.com/equation?tex=%5Cwidetilde+%7B%5Ctextbf%7BC%7D%7D" alt="\widetilde {\textbf{C}}" eeimg="1"> 。包含在 <img src="https://www.zhihu.com/equation?tex=%5Ctext+K" alt="\text K" eeimg="1"> 中的参数称为摄像机的<b>内部参数</b>，因为它们是由摄像机内部结构决定的，不随环境改变，比如焦距。包含在 <img src="https://www.zhihu.com/equation?tex=%5Ctext+R" alt="\text R" eeimg="1"> 和 <img src="https://www.zhihu.com/equation?tex=%5Cwidetilde%7B%5Ctextbf+C%7D" alt="\widetilde{\textbf C}" eeimg="1"> 中的参数成为<b>外部参数</b>，与摄像机的姿态（世界坐标系中的位置和朝向）有关。</p><p data-pid="Fosd9ASr">手机摄像头通常采用CMOS传感器作为图像传感器（除了个别手机，参考<a href="http://link.zhihu.com/?target=https%3A//baike.1688.com/doc/view-d3532948.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">现在还有哪些手机是CCD传感器的？</a>），而数码摄像机通常采用CCD传感器，参考<a href="http://link.zhihu.com/?target=https%3A//mobile.zol.com.cn/334/3347895_all.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">价格决定命运 看手机摄像头CCD与CMOS之争</a>。由于CCD传感器的像素可能不是正方形，如果图像坐标以像素为单位来测量，就需要在每个方向上乘上一个尺度系数 <img src="https://www.zhihu.com/equation?tex=m" alt="m" eeimg="1"> ，那么 </p><p data-pid="QIen6xGZ"><img src="https://www.zhihu.com/equation?tex=%5Calpha_x%3Dfm_x%2C+%5C+%5Calpha_y%3Dfm_y%2C+%5C+x_0%3D+m_xp_x%2C+%5C+y_0+%3D+m_yp_y+%5C%5C" alt="\alpha_x=fm_x, \ \alpha_y=fm_y, \ x_0= m_xp_x, \ y_0 = m_yp_y \\" eeimg="1"> </p><p data-pid="SaULI-Z_">另外有些摄像机可能还存在图像扭曲，坐标轴可能不是严格垂直的，引入扭曲参数 <img src="https://www.zhihu.com/equation?tex=s" alt="s" eeimg="1"> ，最终得到修正后的标定矩阵 <img src="https://www.zhihu.com/equation?tex=%5Ctext+K" alt="\text K" eeimg="1"> ：</p><p data-pid="5p8R9V_E"><img src="https://www.zhihu.com/equation?tex=%5Ctext%7BK%7D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bccc%7D+%5Calpha_x%26s%26x_0%5C%5C+%26%5Calpha_y%26y_0%5C%5C+%26%261+%5Cend%7Barray%7D+%5Cright%5D%5C%5C" alt="\text{K}=\left[\begin{array}{ccc} \alpha_x&amp;s&amp;x_0\\ &amp;\alpha_y&amp;y_0\\ &amp;&amp;1 \end{array} \right]\\" eeimg="1"> </p><p data-pid="_uUsrYmn">摄像机模型的数学描述就介绍完了。对于以上模型参数的确定过程被称作<b>摄像机标定</b>，这是计算机视觉领域一个久远且重要的问题。目前我涉及到的是使用同一相机拍摄的多幅图像直接进行标定的方法，也称作<b>自标定</b>，因为它不需要借助标定板。</p><h2>补充知识</h2><h3>光圈系数</h3><p data-pid="wJc14x-A">令入射孔直径为 <img src="https://www.zhihu.com/equation?tex=d" alt="d" eeimg="1"> ，镜头焦距为 <img src="https://www.zhihu.com/equation?tex=F" alt="F" eeimg="1"> ，我们分别定义相对孔径 <img src="https://www.zhihu.com/equation?tex=d%5E%5Cprime" alt="d^\prime" eeimg="1"> 和光圈系数 <img src="https://www.zhihu.com/equation?tex=f" alt="f" eeimg="1"> 如下：</p><p data-pid="p_sxAgBc"><img src="https://www.zhihu.com/equation?tex=d%5E%5Cprime+%3D+d%2FF%2C%5C+f%3D1%2Fd%5E%5Cprime%3DF%2Fd%5C%5C" alt="d^\prime = d/F,\ f=1/d^\prime=F/d\\" eeimg="1"> </p><p data-pid="nduDVPP2">相对孔径和光圈系数是很容易混淆的，正如<a href="http://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%25E5%2585%2589%25E5%259C%2588%25E7%25B3%25BB%25E6%2595%25B0/9015069%3Ffr%3Daladdin" class=" wrap external" target="_blank" rel="nofollow noreferrer">百度百科光圈系数词条</a>中所说，网上很多资料都写反了。它们互为倒数，很显然相对孔径应该是孔径做分子。关于焦距和光圈系数的表示方法也非常混乱。因为小米的专业相机模式下使用大写 <img src="https://www.zhihu.com/equation?tex=F" alt="F" eeimg="1"> 表示焦距，本文沿用这种写法，并规定使用小写 <img src="https://www.zhihu.com/equation?tex=f" alt="f" eeimg="1"> 表示光圈系数的值。光圈系数记作 <img src="https://www.zhihu.com/equation?tex=F" alt="F" eeimg="1">/# 的形式，其中#是 <img src="https://www.zhihu.com/equation?tex=f" alt="f" eeimg="1"> 的具体值。这种形式只是为了提醒我们光圈的大小 <img src="https://www.zhihu.com/equation?tex=d" alt="d" eeimg="1"> 是和系数成反比的，实际上 <img src="https://www.zhihu.com/equation?tex=d%3DF%2Ff" alt="d=F/f" eeimg="1"> 。光圈越小、光圈系数越大、<img src="https://www.zhihu.com/equation?tex=F" alt="F" eeimg="1">/# 中#的值越大，图像越暗。</p><p data-pid="-ZihKTj6">另外光圈常说大一档、小一档，根据曝光补偿公式，光圈系数和图像亮度是平方反比的关系，又由于前面有个 <img src="https://www.zhihu.com/equation?tex=%5Clog_2" alt="\log_2" eeimg="1"> 所以，大一档指的是 <img src="https://www.zhihu.com/equation?tex=f%27%3D%5Csqrt+2f" alt="f'=\sqrt 2f" eeimg="1"> ，实际上光圈是变小的，这块的定义太反人类了。参考<a href="https://zhuanlan.zhihu.com/p/120801488" class="internal" target="_blank">黑暗森林：镜头F值（镜头光圈系数）</a>。</p><h3>感光度</h3><p data-pid="T74pMRbF">感光度，又称为ISO值，是衡量底片或图像传感器对于光的灵敏程度。ISO这个名字其实就是制定感光度标准的国际标准化组织（<b>I</b>nternational <b>O</b>rganization for <b>S</b>tandardization）。这个组织制定了各个方面的国际标准，包括参与制定C89的C语言标准：<b>ANSI/ISO 9899-1989</b>，所以有时候会看到有些地方把C语言称作ISO C，就特指它制定的原版标准的语法。言归正传，提高感光度可以提升图像亮度，但也会导致图像质量下降。我们一般通过使用大光圈或者外部设备补光来提升画面亮度。</p><h3>曝光补偿</h3><p data-pid="skdti_Sv">上文中已经给出曝光补偿的计算公式。本文这里的 <img src="https://www.zhihu.com/equation?tex=EV" alt="EV" eeimg="1"> 特指摄影学里定义的曝光补偿而不是物理学的曝光值/曝光量。前者可以认为是，为了让画面达到正常亮度我们需要额外增加的曝光量，所以和后者的概念是反的。光圈系数越大（光圈越小）、快门时间越短、感光度越低，需要的曝光补偿就越大。</p><h3>图形变换矩阵</h3><p data-pid="znP-giKx">平移、缩放、错切变换：</p><p data-pid="RvUxjjgG"><img src="https://www.zhihu.com/equation?tex=%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+X%27%5C%5CY%27%5C%5CZ%27%5C%5C1+%5Cend%7Barray%7D+%5Cright%5D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D++S_x+%26+H_%7Bxy%7D%26+H_%7Bxz%7D%26+T_x%5C%5C+0%26+S_y+%26+H_%7Byz%7D%26+T_y%5C%5C+0%26+0%26+S_z+%26+T_z%5C%5C+0%260%260%261+%5Cend%7Barray%7D+%5Cright%5D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+X%5C%5CY%5C%5CZ%5C%5C1+%5Cend%7Barray%7D+%5Cright%5D%5C%5C" alt="\left[\begin{array}{c} X'\\Y'\\Z'\\1 \end{array} \right]=\left[\begin{array}{cccc}  S_x &amp; H_{xy}&amp; H_{xz}&amp; T_x\\ 0&amp; S_y &amp; H_{yz}&amp; T_y\\ 0&amp; 0&amp; S_z &amp; T_z\\ 0&amp;0&amp;0&amp;1 \end{array} \right]\left[\begin{array}{c} X\\Y\\Z\\1 \end{array} \right]\\" eeimg="1"> </p><p data-pid="uGAxhnbA">这里的 <img src="https://www.zhihu.com/equation?tex=S" alt="S" eeimg="1"> 表示各轴缩放比例， <img src="https://www.zhihu.com/equation?tex=T" alt="T" eeimg="1"> 表示沿各轴平移距离， <img src="https://www.zhihu.com/equation?tex=H" alt="H" eeimg="1"> 表示两轴间错切的距离。错切代表的是两轴之间不再是垂直关系，即一个正方形在错切后变成一般的平行四边形。</p><p data-pid="10u9MVN3">旋转变换（这里是绕 <img src="https://www.zhihu.com/equation?tex=z" alt="z" eeimg="1"> 轴逆时针旋转 <img src="https://www.zhihu.com/equation?tex=%5Ctheta" alt="\theta" eeimg="1"> 角度）：</p><p data-pid="GtCheRsV"><img src="https://www.zhihu.com/equation?tex=%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+X%27%5C%5CY%27%5C%5CZ%27%5C%5C1+%5Cend%7Barray%7D+%5Cright%5D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D++%5Ccos+%5Ctheta+%26+-%5Csin+%5Ctheta%26+0%26+0%5C%5C+%5Csin+%5Ctheta%26+%5Ccos+%5Ctheta+%26+0%26+0%5C%5C+0%26+0%26+1+%26+0%5C%5C+0%260%260%261+%5Cend%7Barray%7D+%5Cright%5D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D+X%5C%5CY%5C%5CZ%5C%5C1+%5Cend%7Barray%7D+%5Cright%5D%5C%5C" alt="\left[\begin{array}{c} X'\\Y'\\Z'\\1 \end{array} \right]=\left[\begin{array}{cccc}  \cos \theta &amp; -\sin \theta&amp; 0&amp; 0\\ \sin \theta&amp; \cos \theta &amp; 0&amp; 0\\ 0&amp; 0&amp; 1 &amp; 0\\ 0&amp;0&amp;0&amp;1 \end{array} \right]\left[\begin{array}{c} X\\Y\\Z\\1 \end{array} \right]\\" eeimg="1"> </p><p data-pid="a00vI6Me">可以与本文中的标定矩阵、旋转矩阵对应，慢慢体会其中的规律。这篇文章对于图形学中的基本变换讲解的很详细了：<a href="https://zhuanlan.zhihu.com/p/96717729" class="internal" target="_blank">lxycg：图形学中的基本变换(Basic Transforms)</a>。</p>