<p data-pid="MjtOyFO4">答主<a class="member_mention" href="https://www.zhihu.com/people/f4cc0edde3d07bc8736055ba1bc3f68c" data-hash="f4cc0edde3d07bc8736055ba1bc3f68c" data-hovercard="p$b$f4cc0edde3d07bc8736055ba1bc3f68c">@王泰</a> 已经说的很详细了。网上制作循环GIF图一般使用PS软件，我这里补充一段将不循环的GIF图转为循环的Python代码，对于程序员们更友好和便捷。</p><p data-pid="DV1z32gO">这个问题是有实际场景的：知乎目前的文章只允许插入1MB大小以内的GIF图，而大多数表情包之外的动图都超出了这个大小，这时就需要对GIF的尺寸进行裁剪，或者进行抽帧。在Mac自带的预览功能里可以直接完成这两个操作，但代价就是原本循环播放的GIF变得只动一次了。使用以下代码：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">ImageSequence</span><span class="p">,</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">imageio</span><span class="o">,</span> <span class="nn">os</span> 

<span class="n">location</span> <span class="o">=</span> <span class="s2">"/path/to/"</span>  <span class="c1"># 文件目录</span>
<span class="n">gif_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s2">"origin.gif"</span><span class="p">)</span>  <span class="c1"># 输入GIF文件名</span>
<span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s2">"output.gif"</span><span class="p">)</span>  <span class="c1"># 输出GIF文件名</span>

<span class="c1"># 这里如果想使用灰度图，可以使用`.convert("L")`代替，参考https://pillow-cn.readthedocs.io/zh_CN/latest/handbook/concepts.html#mode</span>
<span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">"RGBA"</span><span class="p">)</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">ImageSequence</span><span class="o">.</span><span class="n">Iterator</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">gif_file</span><span class="p">))]</span>
<span class="n">imageio</span><span class="o">.</span><span class="n">mimsave</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="s1">'GIF'</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># duration表示两帧之间播放的间隔时间，也可不设，使用默认</span>
</code></pre></div><p data-pid="k_4oVD4h">再添加一些逻辑，可以将不循环的GIF图批量转为循环的。在GIF的保存时，不要使用网上流行的这种（可能会影响循环）：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">"out.gif"</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">frames</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</code></pre></div><p data-pid="H6uP22t_">另外，也可以针对知乎的这个1MB场景，配合以上代码，写一个自动的GIF压缩程序~</p>